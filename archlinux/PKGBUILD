# Maintainer: Danil Osherov <shindo@yandex-team.ru>

pkgname=blackhole
pkgdesc="Yet another C++ logging library."
pkgver=0.2.3
pkgrel=1
arch=('x86_64')
url=('https://github.com/3Hren/blackhole')
license=('LGPL3')
depends=('boost>=1.46')
makedepends=('git' 'cmake')
source=("$pkgname"::"git://github.com/shindo/blackhole.git#tag=v$pkgver")
md5sums=('SKIP')
options=('makeflags')

prepare() {
	cd "$srcdir/$pkgname"
	git submodule init
	git submodule update
}

build() {
	cd "$srcdir/$pkgname"
	cmake -DCMAKE_INSTALL_PREFIX=${pkgdir}/usr -DCMAKE_BUILD_TYPE=RelWithDebInfo -DENABLE_TESTING=ON -DENABLE_EXAMPLES=ON -DENABLE_BENCHMARKING=ON
	make -j $(getconf _NPROCESSORS_ONLN 2>/dev/null || echo 1)
}

check() {
	cd "$srcdir/$pkgname"
	make -k -j$(getconf _NPROCESSORS_ONLN 2>/dev/null || echo 1) test
}

package() {
	cd "$srcdir/$pkgname"
	make install
}

